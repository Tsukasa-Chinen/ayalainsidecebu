<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
	<link rel="stylesheet" href="./style.css">
</head>
<body id="search">
	<div class="wrapper">
		<div class="contents">
			<nav class="nav">
				<span id="back_btn" class="nav__button on" data-page="map"></span>
			</nav>
			<!-- /.nav -->
			<div class="search__list_wrapper">
				<div class="search__list_form">
					<input id="search_input" class="search__list_form_input" type="text" placeholder="お店の名前を入力してください">
				</div>
				<!-- /.search__list_form -->
				<div class="search__list">					
					<ul id="shop_list"></ul>
				</div>
				<!-- /.search__list -->
			</div>
			<!-- /.search__list_wrapper -->
		</div>
		<!-- /.contents -->
	</div>
	<!-- /.wrapper -->
<script src="./jquery-2.1.4.min.js"></script>
<script src="./jquery.mobile.custom.min.js"></script>
<script src='./common.js'></script>
<script>
$(function(){

	/* JSON */
	$.getJSON('ayaladate.json' , function($jsonDate) {
		var $shopListElement = '';

		for(var $i in $jsonDate){
			for(var $j in $jsonDate[$i].shopinfo){
				$shopListElement += '<li><span class="js_shop_info" data-shop-id="' + $jsonDate[$i].shopinfo[$j].shopID + '" data-shop-name="' + $jsonDate[$i].shopinfo[$j].name.replace(/\s/g, '-').toLowerCase() + '" data-shop-floor="' + $jsonDate[$i].shopinfo[$j].floor + '">' + $jsonDate[$i].shopinfo[$j].name + '<img class="arrow" src="./arrow_r.svg"></span></li>';
			}
		}
		$('#shop_list').append($shopListElement);
	});
	
	/* Search Action */
	$('#search_input').on('keudown keyup keypress', function(){
		$('#shop_list li').css({'display': 'none'});
		var $searchVal = $(this).val().replace(/\s/g, '-').toLowerCase();

		if($searchVal != ''){	
			$('#shop_list li').each(function(){
				if($('.js_shop_info', this).data('shop-name').indexOf($searchVal) > -1){
					$(this).fadeIn();				
				}
			});
		}
    });

	/* back to Map */
	$(document).on('tap', '#back_btn', function(){
		movePage($(this).data('page'));
	});

	/* Send to Map */
	$(document).on('tap', '.js_shop_info', function(){
	   sendShopInfo($(this).data('shop-id'), $(this).data('shop-name'), $(this).data('shop-floor'));
	});
  
});
</script>
</body>
</html>
